---

- name: Set user directory
  set_fact:
    zsh_user_dir: "{{ ansible_user_dir }}"

- name: Check if wsl
  shell: |
    set -o pipefail
    if [[ "$(uname -a | grep 'microsoft.*standard')" =~ .*"microsoft".* ]]; then echo "true"; else echo "false"; fi
  args:
    executable: /bin/bash
  changed_when: False
  register: is_wsl

- name: Extra repo setup
  include: repo-setup.yml
  when: ansible_os_family != 'Darwin'

- name: Systemd-resolved pre-requisites
  include: systemd-resolved.yml
  when: ansible_os_family != 'Darwin'

- name: Python pip pre-requisites
  include: python-install.yml

- name: Golang installation
  include: golang-install.yml
  when: powerline_version == "go"

- name: Installation steps
  include: install.yml
  tags: [zsh, install]

- name: Configuration steps
  include: configure.yml
  tags: [zsh, configure]

- name: Post installation steps
  include: post-install.yml
  tags: [zsh, install, post_install]

- name: Reset antigen cache
  command: "/bin/zsh -c 'source {{ zsh_config }}; antigen reset'"
  become: true
  become_user: "{{ zsh_user }}"
  changed_when: false
  failed_when: false
  tags: always
